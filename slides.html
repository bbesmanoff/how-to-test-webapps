<section>
<h1>How to Test Web Apps</h1>

<p>Brian Besmanoff<br>
<img class="emoji" title=":octocat:" alt=":octocat:" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png" align="absmiddle"> <a href="https://github.com/bbesmanoff/how-to-test-webapps">bbesmanoff/how-to-test-webapps</a></p>

</section>
<section>

<h1>Who Am I?</h1>

</section>
<section>

<h1>Who Are You?</h1>

<h3>Who who, Who who</h3>
<aside class="notes">  Beginner / Intermediate Web Dev
</aside>
</section>
<section>

<h1>Tech List</h1>

</section>
<section>

<h2>Ruby</h2>

<ul>
<li>RSpec</li>
<li>Capybara</li>
</ul>

</section>
<section>

<h2>Javascript</h2>

<ul>
<li>Backbone</li>
<li>Jasmine</li>
<li>Jasmine-jQuery</li>
</ul>

</section>
<section>

<p><img class="emoji" title=":checkered_flag:" alt=":checkered_flag:" src="https://assets-cdn.github.com/images/icons/emoji/checkered_flag.png" align="absmiddle"></p>

<h1>Let's Get Started</h1>

<p><img class="emoji" title=":checkered_flag:" alt=":checkered_flag:" src="https://assets-cdn.github.com/images/icons/emoji/checkered_flag.png" align="absmiddle"></p>

</section>
<section>

<h1>Javascript</h1>

</section>
<section>

<h1>Jasmine</h1>

<p><img class="emoji" title=":rice:" alt=":rice:" src="https://assets-cdn.github.com/images/icons/emoji/rice.png" align="absmiddle"></p>

</section>
<section>

<h1>Jasmine</h1>

<blockquote>
<p>Jasmine is a Behavior Driven Development testing framework for JavaScript
<a href="http://jasmine.github.io/2.0/introduction.html">http://jasmine.github.io/2.0/introduction.html</a></p>
</blockquote>

</section>
<section>

<p><img class="emoji" title=":alarm_clock:" alt=":alarm_clock:" src="https://assets-cdn.github.com/images/icons/emoji/alarm_clock.png" align="absmiddle"></p>

</section>
<section>

<h1>What is BDD?</h1>

</section>
<section>

<h1>What is BDD?</h1>

<ul>
<li>BDD is a style of testing</li>
<li>English-y descriptions of things</li>
</ul>

</section>
<section>

<h1>Example: Cucumber</h1>

<p><img src="http://cukes.info/images/feature.png" alt="Cucumber Example"></p>

</section>
<section>

<h1>Return to Jasmine</h1>

<p>Cucumber is cool<br>
It looks like English</p>

</section>
<section>

<h2>But I Like JS &gt; English</h2>

</section>
<section>

<h1>Jasmine: An Example</h1>
<pre><code class="javascript">  describe('MyMathModule', function() {
    describe('.abs', function() {
      describe('with negative input', function() {
        it('should return a positive number', function() {
          var result = MyMathModule.abs(-4);
          expect(result).toBeGreaterThan(0);
      });

      describe('with zero as an input', function() {
        it('should return zero', function() {
          var result = MyMathModule.abs(0);
          expect(result).toBe(0);
      });

      describe('with positive input', function() {
        it('should return a positive number', function() {
          var result = MyMathModule.abs(4);
          expect(result).toBeGreaterThan(0);
      });
    });
  });
</code></pre>
<p><a href="jasmine_01.html">example lives here</a></p>

</section>
<section>

<p><img class="emoji" title=":rage:" alt=":rage:" src="https://assets-cdn.github.com/images/icons/emoji/rage.png" align="absmiddle"></p>

</section>
<section>

<h1>B<strong>D</strong>D</h1>

<h2>The <strong>D</strong> is for Driven</h2>

</section>
<section>

<h1>Jasmine: An Example</h1>

<p><a href="jasmine_02.html">now with <img class="emoji" title=":green_heart:" alt=":green_heart:" src="https://assets-cdn.github.com/images/icons/emoji/green_heart.png" align="absmiddle"></a></p>

</section>
<section>

<p><img class="emoji" title=":boom:" alt=":boom:" src="https://assets-cdn.github.com/images/icons/emoji/boom.png" align="absmiddle"> <img class="emoji" title=":boom:" alt=":boom:" src="https://assets-cdn.github.com/images/icons/emoji/boom.png" align="absmiddle"> <img class="emoji" title=":boom:" alt=":boom:" src="https://assets-cdn.github.com/images/icons/emoji/boom.png" align="absmiddle"></p>

</section>
<section>

<h1>Some Other Cool Features</h1>

<ul>
<li>Spies</li>
<li>Clock Management</li>
</ul>

</section>
<section>

<h1>Spies</h1>

<p><em>Spy on</em> a function</p>
<pre><code class="javascript">  var fn = function(s) { console.log(s) };

  describe('fn', function() {
    it('should call console.log', function() {
      spyOn(console, 'log');
      fn("Hello");

      expect(console.log).toHaveBeenCalled();
      expect(console.log).toHaveBeenCalledWith('Hello');
    });
  });
</code></pre>
<p><a href="jasmine_03.html">example here</a></p>

</section>
<section>

<h1>Clock Management</h1>
<pre><code class="javascript">  var waitAndDo = function(fn, ms) { setTimeout(fn, ms); };

  describe('waitAndDo', function() {
    beforeEach(jasmine.clock().install);
    afterEach(jasmine.clock().uninstall);

    it('should wait for 1000000 ms', function() {
      spyOn(console, 'log');
      waitAndDo(function() { console.log('done'); }, 1000000);

      expect(console.log).not.toHaveBeenCalled();

      jasmine.clock().tick(1000000);
      expect(console.log).toHaveBeenCalled();
      expect(console.log).toHaveBeenCalledWith('done');
    });

    it('should show that clock() actually works', function() {
      spyOn(console, 'log');
      waitAndDo(function() { console.log('done'); }, 1);

      expect(console.log).not.toHaveBeenCalled();

      jasmine.clock().tick(1);
      expect(console.log).toHaveBeenCalled();
      expect(console.log).toHaveBeenCalledWith('done');
    });
  });
</code></pre>
<p><a href="jasmine_04.html">example here</a></p>

</section>
<section>

<h1>Jasmine-jQuery</h1>

</section>
<section>

<h1>Jasmine-jQuery</h1>

<p>A set of additonal, jQuery-friendly, matchers for Jasmine</p>

</section>
<section>

<h2>But doesn't Jasmine have enough?</h2>

<ul>
<li><code>toBe</code></li>
<li><code>toMatch</code></li>
<li><code>toContain</code></li>
<li><code>toBeTruthy</code></li>
<li><code>toBeDefined</code></li>
<li><code>...</code></li>
</ul>

</section>
<section>

<h2>What looks more English-y?</h2>

<p><code>expect($('#elem').attr('checked')).toBeTruthy()</code></p>

<p>-or-</p>

<p><code>expect($('#elem')).toBeChecked()</code></p>

</section>
<section>

<h2>Jasmine-jQuery: An Example</h2>
<pre><code class="javascript">describe('The Big Red Button', function() {
  describe('when clicked', function() {
    beforeEach(function() {
      var $button = $('#btn');
      $button.trigger('click');
    });

    it ('should update the label', function() {
      expect($('#lbl')).toHaveText('Why would you do that?!?!');
    });
  });
});
</code></pre>
<p><a href="jasmine-jquery_01.html">example here</a></p>

</section>
<section>

<p><img src="http://i.giphy.com/JFCTv9AvwFBJK.gif" alt="Red Pill GIF"></p>

</section>
<section>

<h1>A Little Bit of Backbone</h1>

<blockquote>
<p>Backbone.js gives structure to web applications by providing models with
key-value binding and custom events, collections with a rich API of enumerable
functions, views with declarative event handling...<br>
<a href="http://backbonejs.org/">http://backbonejs.org/</a></p>
</blockquote>

</section>
<section>

<h1>What Does That Even Mean?</h1>

</section>
<section>

<h1>What Does That Even Mean?</h1>

<ul>
<li>Client-side MVC Framework</li>
</ul>

</section>
<section>

<h1>What Does That Even Mean?</h1>

<p>Models, Collections, Views  </p>

</section>
<section>

<h1>What Does That Even Mean?</h1>

<p>Collections contain models<br>
Views display collections and/or models</p>

</section>
<section>

<h1>Show, Don't Tell</h1>

<p><a href="backbone_01.html">#fail</a></p>
<aside class="notes">The example wasn't being parsed properly and would have been a little long for a
slide
</aside>
</section>
<section>

<h1>Where Does Jasmine Come in?</h1>

</section>
<section>

<h2>Example: Let's Test This Puppy</h2>

<p>Testing the model:</p>
<pre><code class="javascript">  describe('StudentModel', function() {
    beforeEach(function() {
      this.student = new StudentModel({name: 'Joe Schmoe', year: 2});
    });

    describe('#procrastinate', function() {
      it('should write to the console', function() {
        spyOn(console, 'log');

        this.student.procrastinate();

        expect(console.log).toHaveBeenCalled();
        expect(console.log).toHaveBeenCalledWith('Joe Schmoe is procrastinating.  Typical year 2 things.');
      });
    });
  });
</code></pre>
</section>
<section>

<h2>Example: Let's Test This Puppy</h2>

<p>Testing the view:</p>
<pre><code class="javascript">  describe('StudentView', function() {
    beforeEach(function() {
      this.student = new StudentModel({name: 'Joe Schmoe', year: 2});
    });

    describe('#render', function() {
      var $rendered;

      beforeEach(function() {
        var view = new StudentView({model: this.student});
        $rendered = view.render().$el;
      });

      it ('should be a list item', function() {
        expect($rendered).toBeMatchedBy('li');
      });

      it('should include a student\'s name', function() {
        expect($rendered).toContainText('Joe Schmoe');
      });

      it('should include a student\'s year', function() {
        expect($rendered).toContainText('2');
      });

      it('should include a procrastination link', function() {
        expect($rendered).toContainElement('a');
      });

      describe('the procrastination link', function() {
        var $link;

        beforeEach(function() {
          $link = $rendered.find('a');
        });

        it('should call the model\'s procrastinate method', function() {
          spyOn(this.student, 'procrastinate').and.callThrough();
          $link.trigger('click');

          expect(this.student.procrastinate).toHaveBeenCalled();
        });
      });
    });
  });
</code></pre>
<p><a href="backbone_jasmine_01.html">example here</a></p>

</section>
<section>

<p><img class="emoji" title=":smiley:" alt=":smiley:" src="https://assets-cdn.github.com/images/icons/emoji/smiley.png" align="absmiddle"></p>

</section>
<section>

<h1>Let's Talk About Ruby</h1>

</section>
<section>

<h1>Let's Talk About Ruby</h1>

<p>Javascript &lt; --- &gt; Ruby</p>

</section>
<section>

<h1>Let's Talk About Ruby</h1>

<p>Jasmine &lt; --- &gt; RSpec</p>

</section>
<section>

<h1>RSpec</h1>
<pre><code class="ruby">describe MyMathModule do
  describe '#abs' do
    describe 'with negative input' do
      it 'should return a positive number' do
        actual = MyMathModule.abs -4

        expect(actual).to satisfy { |v| v &gt; 0 }
      end
    end
  end
end
</code></pre>
<p>examples are in this repository, but let's go to the shell</p>

</section>
<section>

<p><img src="http://img1.wikia.nocookie.net/__cb20130810045256/cookieclicker/images/2/24/Capybara-02.jpg" alt="Capybara"></p>

</section>
<section>

<h1>Capybara</h1>

<blockquote>
<p>Capybara helps you test web applications by simulating how a real user would
interact with your app.</p>

<p><a href="https://github.com/jnicklas/capybara">https://github.com/jnicklas/capybara</a></p>
</blockquote>

</section>
<section>

<h1>See Also:</h1>

<p>Selenium</p>

</section>
<section>

<h1>Let's Write a Test</h1>
<pre><code class="ruby">  describe 'This Talk\'s Presentation' do
    let(:url) { 'https://bbesmanoff.github.io/how-to-test-webapps' }
    let(:gh_repo) { 'https://github.com/bbesmanoff/how-to-test-webapps' }
    let(:link_text) { 'bbesmanoff/how-to-test-webapps' }
    let(:right_arrow_selector) { '.navigate-right' }

    before :each do
      visit url
    end

    describe 'the repo link' do
      it 'should link to the repo' do
        click_link link_text

        expect(page.current_url).to eq gh_repo
      end
    end

    describe 'the right arrow' do
      describe 'using it to switch slides' do
        before :each do
          arrow = page.find :css, right_arrow_selector
          arrow.click
        end

        it 'should show the second slide' do
          current_slide = page.find :css, 'section.present'
          expect(current_slide.text).to eq 'WHO AM I?'
        end
      end
    end
  end
</code></pre>
<p>example in shell</p>

</section>
<section>

<h1>
<img class="emoji" title=":thumbsup:" alt=":thumbsup:" src="https://assets-cdn.github.com/images/icons/emoji/thumbsup.png" align="absmiddle"> <img class="emoji" title=":question:" alt=":question:" src="https://assets-cdn.github.com/images/icons/emoji/question.png" align="absmiddle">
</h1>

</section>
<section>

<h1><img class="emoji" title=":x:" alt=":x:" src="https://assets-cdn.github.com/images/icons/emoji/x.png" align="absmiddle"></h1>

</section>
<section>

<h1>Conerns</h1>

<p>Right now, the test knows <strong>a lot</strong> about the page</p>

</section>
<section>

<h1>Conerns</h1>

<p>What if we wanted to extend the test suite?
Add some negative cases?</p>

</section>
<section>

<p><img class="emoji" title=":clipboard:" alt=":clipboard:" src="https://assets-cdn.github.com/images/icons/emoji/clipboard.png" align="absmiddle"></p>

</section>
<section>

<h1>Conerns</h1>

<p>Now the selector changes for something</p>

</section>
<section>

<p><img class="emoji" title=":poop:" alt=":poop:" src="https://assets-cdn.github.com/images/icons/emoji/poop.png" align="absmiddle"></p>

</section>
<section>

<h1>Page Objects to the Rescue!</h1>

</section>
<section>

<h1>What Is a Page Object?</h1>

<ul>
<li>Object Oriented Wrapper around a single element

<ul>
<li>Page</li>
<li>Particular Widget</li>
</ul>
</li>
</ul>

</section>
<section>

<h1>What Does it Look Like?</h1>
<pre><code class="ruby">class Slideshow
    def initialize(url)
      @down_arrow = Reveal::Arrow.new 'down'
      @left_arrow = Reveal::Arrow.new 'left'
      @right_arrow = Reveal::Arrow.new 'right'
      @up_arrow = Reveal::Arrow.new 'up'

      @url = url
    end

    def content
      page.find :css, 'section.present'
    end

    def text
      content = page.find :css, 'section.present'
      content.text
    end
...
</code></pre>
</section>
<section>

<h1>What Does the Test Look Like?</h1>
<pre><code class="ruby">  describe 'This Presentation' do
    let(:url) { 'http://bbesmanoff.github.io/how-to-test-webapps/#/' }

    before :each do
      visit url

      @slideshow = Reveal::Slideshow.new url
    end

    describe 'the index page' do
      it 'should be the first slide' do
        expect(@slideshow.first?).to be_truthy
      end

      it 'should be treated as slide 0' do
        expect(@slideshow.current_slide).to be_zero
      end
    end

  ...
</code></pre>
</section>
<section>

<h1>Page Objects</h1>

<ul>
<li>Encapsulation</li>
<li>Consistent Interface</li>
</ul>

</section>
<section>

<h1>Put it All Together</h1>

</section>
<section>

<h1>Put it All Together</h1>

<p><em>an excercise left for the reader</em></p>

</section>
<section>

<h1>Unsolicited Tips</h1>

<ol>
<li>Think about what you're tests are saying</li>
</ol>

</section>
<section>

<h1>Unsolicited Tips</h1>

<ol>
<li>Think about what you're tests are saying

<ul>
<li>Is it English?</li>
</ul>
</li>
</ol>

</section>
<section>

<h1>Unsolicited Tips</h1>

<ol>
<li>Think about what you're tests are saying

<ul>
<li>Is it English?</li>
<li>Can you hand your test output to someone and they understand it?</li>
</ul>
</li>
</ol>

</section>
<section>

<h1>Unsolicited Tips</h1>

<ol>
<li>Think about what you're tests are saying

<ul>
<li>Is it English?</li>
<li>Can you hand your test output to someone and they understand it?</li>
<li>Can you hand your test <em>input</em> to someone and they understand it?</li>
</ul>
</li>
</ol>

</section>
<section>

<h1>
<img class="emoji" title=":question:" alt=":question:" src="https://assets-cdn.github.com/images/icons/emoji/question.png" align="absmiddle"> <img class="emoji" title=":question:" alt=":question:" src="https://assets-cdn.github.com/images/icons/emoji/question.png" align="absmiddle"> <img class="emoji" title=":question:" alt=":question:" src="https://assets-cdn.github.com/images/icons/emoji/question.png" align="absmiddle">
</h1>

</section>
